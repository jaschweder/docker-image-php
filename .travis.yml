sudo: required

language: generic

services:
  - docker

env:
  - IMAGE_FROM='jaschweder\/php:server' IMAGE_TO=jaschweder/php:laravel DOWNSTREAM=true
  - IMAGE_FROM='jaschweder\/php:7.1-server' IMAGE_TO=jaschweder/php:7.1-laravel DOWNSTREAM=true
  - IMAGE_FROM='jaschweder\/php:7.2-server' IMAGE_TO=jaschweder/php:7.2-laravel DOWNSTREAM=true
  - IMAGE_FROM='jaschweder\/php:sqlsrv-server' IMAGE_TO=jaschweder/php:sqlsrv-laravel DOWNSTREAM=true
  - IMAGE_FROM='jaschweder\/php:5.6-server' IMAGE_TO=jaschweder/php:5.6-laravel DOWNSTREAM=false
  - IMAGE_FROM='jaschweder\/php:5.6-sybase-server' IMAGE_TO=jaschweder/php:5.6-sybase-laravel DOWNSTREAM=false

script:
  - sed -e s/{IMAGE_FROM}/$IMAGE_FROM/g Dockerfile-template > Dockerfile
  - docker build -t $IMAGE_TO .

after_success:
  - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
  - docker push $IMAGE_TO;
