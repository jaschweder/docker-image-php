FROM {IMAGE_FROM}

MAINTAINER Jonathan A. Schweder "jonathanschweder@gmail.com"

############################################################################
#                                   Nginx                                  #
############################################################################

COPY ./nginx-vh-default /etc/nginx/sites-available/default

############################################################################
#                                   Queue                                  #
############################################################################

COPY ./queue-worker.conf /etc/supervisor/conf.d/queue-worker.conf

############################################################################
#                                Schedule                                  #
############################################################################

RUN apt-get update -y \
    && apt-get upgrade -y \
    && apt-get install \
    cron \
    --no-install-recommends \
    --no-install-suggests \
    -y \
    && rm -rf /var/lib/apt/lists/* \
    && apt-get autoremove \
    && apt-get autoclean \
    && echo '* * * * * php /var/www/artisan schedule:run >> /dev/null 2>&1' > /etc/cron.d/schedule

COPY ./schedule.conf /etc/supervisor/conf.d/schedule.conf
