FROM {IMAGE_FROM}

MAINTAINER Jonathan A. Schweder "jonathanschweder@gmail.com"

RUN apt-get update -y \
    && apt-get install \
    yasm \
    libmp3lame-dev \
    libx264-dev \
    git \
    build-essential \
    cmake \
    pkg-config \
    libusb-dev \
    libasound2-dev \
    alsa-utils \
    alsa \
    alsa-oss \
    curl \
    gettext-base \
    -y
    
############################################################################
#                                  node                                    #
############################################################################
RUN git clone -b v6.x --depth 1  https://github.com/nodejs/node /usr/src/node \
    && cd /usr/src/node \
    && ./configure \
    && make -j$(nproc) \
    && make install \
    && rm -rf /usr/src/node
    
RUN npm install -g gulp

############################################################################
#                                 ffmpeg                                   #
############################################################################

RUN mkdir -p /usr/src \
    && cd /usr/src \
    && git clone -b n3.2.7 --depth 1 --single-branch https://github.com/ffmpeg/ffmpeg \
    && cd ffmpeg \
    && ./configure \
    --enable-libmp3lame \
    --enable-gpl \
    --enable-libx264 \
    --enable-shared \
    --disable-static \
    && make all -j$(nproc) \
    && make install

ENV PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/local/lib/pkgconfig
ENV LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib/

WORKDIR /usr/share/nginx/htm
